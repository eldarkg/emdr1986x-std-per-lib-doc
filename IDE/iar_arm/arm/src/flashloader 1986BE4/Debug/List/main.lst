###############################################################################
#                                                                             #
# IAR ANSI C/C++ Compiler V6.40.2.53884/W32 for ARM     04/Aug/2014  13:04:05 #
# Copyright 1999-2012 IAR Systems AB.                                         #
#                                                                             #
#    Cpu mode     =  thumb                                                    #
#    Endian       =  little                                                   #
#    Source file  =  C:\Users\sidorov.a\workspace\mdr1986x-std-per-lib\IDE\ia #
#                    r_arm\arm\src\flashloader 1986BE4\main.c                 #
#    Command line =  "C:\Users\sidorov.a\workspace\mdr1986x-std-per-lib\IDE\i #
#                    ar_arm\arm\src\flashloader 1986BE4\main.c" -lCN          #
#                    "C:\Users\sidorov.a\workspace\mdr1986x-std-per-lib\IDE\i #
#                    ar_arm\arm\src\flashloader 1986BE4\Debug\List\" -o       #
#                    "C:\Users\sidorov.a\workspace\mdr1986x-std-per-lib\IDE\i #
#                    ar_arm\arm\src\flashloader 1986BE4\Debug\Obj\" --no_cse  #
#                    --no_unroll --no_inline --no_code_motion --no_tbaa       #
#                    --no_clustering --no_scheduling --debug --endian=little  #
#                    --cpu=Cortex-M0 -e --fpu=None --dlib_config "C:\Program  #
#                    Files (x86)\IAR Systems\Embedded Workbench               #
#                    6.4\arm\INC\c\DLib_Config_Normal.h" -I                   #
#                    "C:\Users\sidorov.a\workspace\mdr1986x-std-per-lib\IDE\i #
#                    ar_arm\arm\src\flashloader 1986BE4\" -On --ropi          #
#                    --use_c++_inline -I "C:\Program Files (x86)\IAR          #
#                    Systems\Embedded Workbench 6.4\arm\CMSIS\Include\"       #
#    List file    =  C:\Users\sidorov.a\workspace\mdr1986x-std-per-lib\IDE\ia #
#                    r_arm\arm\src\flashloader 1986BE4\Debug\List\main.lst    #
#    Object file  =  C:\Users\sidorov.a\workspace\mdr1986x-std-per-lib\IDE\ia #
#                    r_arm\arm\src\flashloader 1986BE4\Debug\Obj\main.o       #
#                                                                             #
#                                                                             #
###############################################################################

C:\Users\sidorov.a\workspace\mdr1986x-std-per-lib\IDE\iar_arm\arm\src\flashloader 1986BE4\main.c
      1          /**************************************************
      2           * Copyright 2004-2010 IAR Systems. All rights reserved.
      3           *
      4           * $Revision: 29 $
      5           **************************************************/
      6          
      7          #include <stdio.h>
      8          #include <stdlib.h>
      9          #include <string.h>
     10          #include <MDR1986BE4.h>
     11          #include "flash_loader.h"
     12          //#include "boot_loader.h"
     13          
     14          #define STANDBY 0x30L
     15          #define READ    0x00L
     16          #define PROGRAM 0x21L
     17          #define PGERASE 0x22L
     18          #define READCDI 0x0BL
     19          #define READDID 0x0CL
     20          
     21          #define flash_unit uint32_t
     22          #define BOOT_SIZE	341
     23          

   \                                 In section .rodata, align 4
     24          const unsigned int BOOT_LOADER[BOOT_SIZE] =
   \                     BOOT_LOADER:
   \   00000000   0x20000408         DC32 536871944, 1177, 1181, 1183, 0, 0, 0, 0, 0, 0, 0, 1185, 0, 0, 1187
   \              0x00000499   
   \              0x0000049D   
   \              0x0000049F   
   \              0x00000000   
   \              0x00000000   
   \              0x00000000   
   \              0x00000000   
   \              0x00000000   
   \              0x00000000   
   \              0x00000000   
   \              0x000004A1   
   \              0x00000000   
   \              0x00000000   
   \              0x000004A3   
   \   0000003C   0x000004A5         DC32 1189, 1191, 1193, 1195, 1197, 1199, 1201, 1203, 1205, 1207, 1209
   \              0x000004A7   
   \              0x000004A9   
   \              0x000004AB   
   \              0x000004AD   
   \              0x000004AF   
   \              0x000004B1   
   \              0x000004B3   
   \              0x000004B5   
   \              0x000004B7   
   \              0x000004B9   
   \   00000068   0x000004BB         DC32 1211, 1213, 1215, 1217, 1219, 1221, 1223, 1183139843, 4197904384
   \              0x000004BD   
   \              0x000004BF   
   \              0x000004C1   
   \              0x000004C3   
   \              0x000004C5   
   \              0x000004C7   
   \              0x46854803   
   \              0xFA36F000   
   \   0000008C   0x47004800         DC32 1191200768, 491, 536871944, 101261600, 805398536, 3170996225
   \              0x000001EB   
   \              0x20000408   
   \              0x06092120   
   \              0x30016808   
   \              0xBD019001   
   \   000000A4   0x00004770         DC32 18288, 1174648080, 1290469592, 1290475778, 1642096656, 1654653408
   \              0x4603B510   
   \              0x4CEB00D8   
   \              0x4CEB1902   
   \              0x61E06810   
   \              0x62A001E0   
   \   000000BC   0x20006851         DC32 536897617, 537223240, 537092232, 536895688, 1632133384, 1636311042
   \              0x20056048   
   \              0x20036088   
   \              0x200060C8   
   \              0x61486108   
   \              0x61882002   
   \   000000D4   0x60482001         DC32 1615339521, 3171961058, 1770176256, 1109009280, 570478843
   \              0xBD1048E2   
   \              0x6982BF00   
   \              0x421A2380   
   \              0x2200D0FB   
   \   000000E8   0x098A6302         DC32 160064258, 109732418, 1652690578, 1656889952, 1661094619
   \              0x068A6242   
   \              0x62820E92   
   \              0x62C22260   
   \              0x63024ADB   
   \   000000FC   0xE0034770         DC32 3758311280, 1109009216, 1745080320, 589326722, 3522642458
   \              0x421A2340   
   \              0x6803D000   
   \              0x23206982   
   \              0xD1F7421A   
   \   00000110   0x47706001         DC32 1198546945, 3204466177, 571500936, 3522904592, 83912712
   \              0xBF004601   
   \              0x22106988   
   \              0xD1FB4210   
   \              0x05006808   
   \   00000124   0x47700D00         DC32 1198525696, 570443265, 3204505611, 588278152, 3522904600, 83912712
   \              0x22004601   
   \              0xBF00E00B   
   \              0x23106988   
   \              0xD1FB4218   
   \              0x05006808   
   \   0000013C   0xD0010D00         DC32 3489729792, 1198530561, 705698898, 536925169, 3037784057
   \              0x47702001   
   \              0x2A101C52   
   \              0x2000D3F1   
   \              0xB510E7F9   
   \   00000150   0x21004602         DC32 553666050, 3204505617, 605055376, 3522904608, 83912720, 1124142336
   \              0xBF00E011   
   \              0x24106990   
   \              0xD1FB4220   
   \              0x05006810   
   \              0x43010D00   
   \   00000168   0x060C0A18         DC32 101452312, 1174618912, 34146825, 50339841, 536942601, 1115751296
   \              0x46034320   
   \              0x02090A09   
   \              0x03002001   
   \              0x20011809   
   \              0x42810380   
   \   00000180   0x200FD3E9         DC32 537908201, 1107362304, 536924162, 3171959744, 3892069912
   \              0x42010200   
   \              0x2000D002   
   \              0xBD1043C0   
   \              0xE7FC4618   
   \   00000194   0x4602B530         DC32 1174582576, 721438219, 604098562, 3758096996, 620831744
   \              0x2B00460B   
   \              0x2401D002   
   \              0xE0000264   
   \              0x25012400   
   \   000001A8   0x43294621         DC32 1126778401, 1303399599, 1177313580, 1617059873, 1124869184
   \              0x4DB04CAF   
   \              0x462C612C   
   \              0x60626021   
   \              0x430C2440   
   \   000001BC   0x358125FF         DC32 897656319, 1303069484, 1177313324, 604006624, 1630298156
   \              0x4DAB432C   
   \              0x462C602C   
   \              0x240068E0   
   \              0x612C602C   
   \   000001D0   0x2200BD30         DC32 570473776, 1619157058, 1623361546, 1627555914, 1631724032
   \              0x60826042   
   \              0x60C2880A   
   \              0x6102884A   
   \              0x61422200   
   \   000001E4   0x6182684A         DC32 1635936330, 2961590128, 1234978977, 1218535880, 2416208768
   \              0xB0864770   
   \              0x499C48A1   
   \              0x48A161C8   
   \              0x90046B80   
   \   000001F8   0x48A149A0         DC32 1218529696, 4293523455, 1218529696, 4293261311, 3758237440
   \              0xFFE9F7FF   
   \              0x48A149A0   
   \              0xFFE5F7FF   
   \              0xE0022700   
   \   0000020C   0x68002000         DC32 1744838656, 795090047, 536925178, 1218154501, 130050048
   \              0x2F641C7F   
   \              0x2000D3FA   
   \              0x489B9005   
   \              0x07C06800   
   \   00000220   0x90050F80         DC32 2416250752, 1744849046, 264243136, 1124636933, 536907781
   \              0x68004896   
   \              0x0FC007C0   
   \              0x43089905   
   \              0x20009005   
   \   00000234   0x61084992         DC32 1627933074, 1636327624, 1627933074, 1636327624, 671127557
   \              0x618860C8   
   \              0x61084992   
   \              0x618860C8   
   \              0x28009805   
   \   00000248   0x2801D006         DC32 671207430, 671272971, 671338506, 3758674182, 46735617, 1124636676
   \              0x2802D00B   
   \              0x2803D00A   
   \              0xE008D106   
   \              0x02C92101   
   \              0x43089804   
   \   00000260   0x63884985         DC32 1669876101, 3204505847, 1233370880, 1669896196, 508074245
   \              0xBF00E0F7   
   \              0x4983BF00   
   \              0x63889804   
   \              0x1E489905   
   \   00000274   0xFF18F7FF         DC32 4279826431, 3204485121, 1174685827, 3758985219, 2550220321
   \              0xBF009001   
   \              0x46044883   
   \              0xE00D9003   
   \              0x98014621   
   \   00000288   0xFF28F7FF         DC32 4280875007, 4160722945, 873660225, 4160722945, 671153991
   \              0xF7FF9801   
   \              0x3412FF41   
   \              0xF7FF9801   
   \              0x2800FF47   
   \   0000029C   0x9403D000         DC32 2483277824, 1115965563, 2550387203, 676993568, 2550387690
   \              0x4284487B   
   \              0x9803D203   
   \              0x285A1A20   
   \              0x9803D3EA   
   \   000002B0   0x285A1A20         DC32 676993568, 3759002594, 2550220321, 4279171071, 4160722945
   \              0xE00DD3E2   
   \              0x98014621   
   \              0xFF0EF7FF   
   \              0xF7FF9801   
   \   000002C4   0x9801FF27         DC32 2550267687, 4281268223, 3489671168, 873652227, 1115965550
   \              0xFF2EF7FF   
   \              0xD0002800   
   \              0x3412E003   
   \              0x4284486E   
   \   000002D8   0xBF00D3EE         DC32 3204502510, 419469315, 1176569924, 4160722945, 654376697
   \              0x19009803   
   \              0x46210844   
   \              0xF7FF9801   
   \              0x2700FEF9   
   \   000002EC   0x9801E003         DC32 2550259715, 4279302143, 789585023, 638440441, 536919808, 170954754
   \              0xFF10F7FF   
   \              0x2F101C7F   
   \              0x260DD3F9   
   \              0x2000BF00   
   \              0x0A309002   
   \   00000304   0x2069D001         DC32 543805441, 2550304770, 3514312704, 3493998156, 771808262
   \              0x98029002   
   \              0xD1782800   
   \              0xD0422E4C   
   \              0x2E00DC06   
   \   00000318   0x2E0DD009         DC32 772657161, 776130568, 3759329648, 3497274962, 3522768473
   \              0x2E42D008   
   \              0xE012D170   
   \              0xD0742E52   
   \              0xD1F92E59   
   \   0000032C   0xE085E036         DC32 3766870070, 2550210829, 4276353023, 2550210826, 4276090879
   \              0x9801210D   
   \              0xFEE3F7FF   
   \              0x9801210A   
   \              0xFEDFF7FF   
   \   00000340   0x9801213E         DC32 2550210878, 4275828735, 2550259832, 4278188031, 476595717
   \              0xFEDBF7FF   
   \              0x9801E078   
   \              0xFEFFF7FF   
   \              0x1C684605   
   \   00000354   0x2069D102         DC32 543805698, 3765407746, 3506580736, 2416058466, 558620778
   \              0xE06F9002   
   \              0xD1022D00   
   \              0x90022062   
   \              0x214BE06A   
   \   00000368   0x436101C9         DC32 1130430921, 1177110024, 4172083200, 759186949, 536990467
   \              0x46294608   
   \              0xF8ACF000   
   \              0x2D404605   
   \              0x2001D303   
   \   0000037C   0x42850580         DC32 1116013952, 543347458, 3763965954, 2550210882, 4273469439
   \              0x2062D302   
   \              0xE0599002   
   \              0x98012142   
   \              0xFEB7F7FF   
   \   00000390   0x98014629         DC32 2550220329, 4272093183, 3204505680, 4160722945, 1174798038
   \              0xFEA2F7FF   
   \              0xBF00E050   
   \              0xF7FF9801   
   \              0x4605FED6   
   \   000003A4   0xF7FF9801         DC32 4160722945, 2415984338, 3489799272, 473995264, 543805698
   \              0x9000FED2   
   \              0xD0021C68   
   \              0x1C409800   
   \              0x2069D102   
   \   000003B8   0xE03F9002         DC32 3762262018, 2550220337, 4271765503, 423663616, 3759312896
   \              0x98014631   
   \              0xFE9DF7FF   
   \              0x19409800   
   \              0xE0129000   
   \   000003CC   0xD1042E59         DC32 3506712153, 2550233129, 4271110143, 2550259722, 4271568895
   \              0x98017829   
   \              0xFE93F7FF   
   \              0x9801E00A   
   \              0xFE9AF7FF   
   \   000003E0   0x0A184603         DC32 169362947, 543805442, 3758460930, 3204476971, 2550144109
   \              0x2069D002   
   \              0xE0059002   
   \              0xBF00702B   
   \              0x98001C6D   
   \   000003F4   0xD3E94285         DC32 3555279493, 2550316800, 3489867776, 3759988764, 3758415895
   \              0x9802BF00   
   \              0xD0032800   
   \              0xE01CE01C   
   \              0xE004E017   
   \   00000408   0x9801214B         DC32 2550210891, 4269275135, 2550259732, 4271634431, 476595717
   \              0xFE77F7FF   
   \              0x9801E014   
   \              0xFE9BF7FF   
   \              0x1C684605   
   \   0000041C   0x2069D102         DC32 543805698, 3758854146, 2550210898, 4268357631, 1610958873
   \              0xE00B9002   
   \              0x98012152   
   \              0xFE69F7FF   
   \              0x60054819   
   \   00000430   0xFE32F7FF         DC32 4264753151, 543407872, 3204485122, 2550316800, 3489867776
   \              0x2063BF00   
   \              0xBF009002   
   \              0x9802BF00   
   \              0xD0032800   
   \   00000444   0x98012145         DC32 2550210885, 4267309055, 4160722945, 1174863457, 3204507475
   \              0xFE59F7FF   
   \              0xF7FF9801   
   \              0x4606FE61   
   \              0xBF00E753   
   \   00000458   0xE7FEBF00         DC32 3892231936, 1308, 1073872896, 1073774592, 769, 2326418769
   \              0x0000051C   
   \              0x40020000   
   \              0x40008000   
   \              0x00000301   
   \              0x8AAA5551   
   \   00000470   0x40018000         DC32 1073840128, 397328, 1074135040, 1340, 1074298880, 1332, 1074331648
   \              0x00061010   
   \              0x40060000   
   \              0x0000053C   
   \              0x40088000   
   \              0x00000534   
   \              0x40090000   
   \   0000048C   0x00000A04         DC32 2564, 4762, 536870912, 1191200779, 3892242430, 3892242430
   \              0x0000129A   
   \              0x20000000   
   \              0x4700480B   
   \              0xE7FEE7FE   
   \              0xE7FEE7FE   
   \   000004A4   0xE7FEE7FE         DC32 3892242430, 3892242430, 3892242430, 3892242430, 3892242430
   \              0xE7FEE7FE   
   \              0xE7FEE7FE   
   \              0xE7FEE7FE   
   \              0xE7FEE7FE   
   \   000004B8   0xE7FEE7FE         DC32 3892242430, 3892242430, 3892242430, 59390, 133, 1175172400
   \              0xE7FEE7FE   
   \              0xE7FEE7FE   
   \              0x0000E7FE   
   \              0x00000085   
   \              0x460BB530   
   \   000004D0   0x20004601         DC32 536888833, 604054048, 1175314441, 1117602005, 1176359685
   \              0x24012220   
   \              0x460DE009   
   \              0x429D40D5   
   \              0x461DD305   
   \   000004E4   0x1B494095         DC32 457785493, 1083524645, 1175787840, 754982482, 3174096113
   \              0x40954625   
   \              0x46151940   
   \              0x2D001E52   
   \              0xBD30DCF1   
   \   000004F8   0x25014C06         DC32 620841990, 3758444038, 1759725088, 1126942727, 873482136
   \              0xE0054E06   
   \              0x68E34620   
   \              0x432BC807   
   \              0x34104798   
   \   0000050C   0xD3F742B4         DC32 3556197044, 4257019903, 1348, 1348, 131098, 1074298880, 131098
   \              0xFDBCF7FF   
   \              0x00000544   
   \              0x00000544   
   \              0x0002001A   
   \              0x40088000   
   \              0x0002001A   
   \   00000528   0x40088000         DC32 1074298880, 131098, 1074298880, 65537, 0, 65537, 0, 0, 0, 0, 0
   \              0x0002001A   
   \              0x40088000   
   \              0x00010001   
   \              0x00000000   
   \              0x00010001   
   \              0x00000000   
   \              0x00000000   
   \              0x00000000   
   \              0x00000000   
   \              0x00000000   
     25          {
     26          0x20000408,
     27          0x00000499,
     28          0x0000049D,
     29          0x0000049F,
     30          0x00000000,
     31          0x00000000,
     32          0x00000000,
     33          0x00000000,
     34          0x00000000,
     35          0x00000000,
     36          0x00000000,
     37          0x000004A1,
     38          0x00000000,
     39          0x00000000,
     40          0x000004A3,
     41          0x000004A5,
     42          0x000004A7,
     43          0x000004A9,
     44          0x000004AB,
     45          0x000004AD,
     46          0x000004AF,
     47          0x000004B1,
     48          0x000004B3,
     49          0x000004B5,
     50          0x000004B7,
     51          0x000004B9,
     52          0x000004BB,
     53          0x000004BD,
     54          0x000004BF,
     55          0x000004C1,
     56          0x000004C3,
     57          0x000004C5,
     58          0x000004C7,
     59          0x46854803,
     60          0xFA36F000,
     61          0x47004800,
     62          0x000001EB,
     63          0x20000408,
     64          0x06092120,
     65          0x30016808,
     66          0xBD019001,
     67          0x00004770,
     68          0x4603B510,
     69          0x4CEB00D8,
     70          0x4CEB1902,
     71          0x61E06810,
     72          0x62A001E0,
     73          0x20006851,
     74          0x20056048,
     75          0x20036088,
     76          0x200060C8,
     77          0x61486108,
     78          0x61882002,
     79          0x60482001,
     80          0xBD1048E2,
     81          0x6982BF00,
     82          0x421A2380,
     83          0x2200D0FB,
     84          0x098A6302,
     85          0x068A6242,
     86          0x62820E92,
     87          0x62C22260,
     88          0x63024ADB,
     89          0xE0034770,
     90          0x421A2340,
     91          0x6803D000,
     92          0x23206982,
     93          0xD1F7421A,
     94          0x47706001,
     95          0xBF004601,
     96          0x22106988,
     97          0xD1FB4210,
     98          0x05006808,
     99          0x47700D00,
    100          0x22004601,
    101          0xBF00E00B,
    102          0x23106988,
    103          0xD1FB4218,
    104          0x05006808,
    105          0xD0010D00,
    106          0x47702001,
    107          0x2A101C52,
    108          0x2000D3F1,
    109          0xB510E7F9,
    110          0x21004602,
    111          0xBF00E011,
    112          0x24106990,
    113          0xD1FB4220,
    114          0x05006810,
    115          0x43010D00,
    116          0x060C0A18,
    117          0x46034320,
    118          0x02090A09,
    119          0x03002001,
    120          0x20011809,
    121          0x42810380,
    122          0x200FD3E9,
    123          0x42010200,
    124          0x2000D002,
    125          0xBD1043C0,
    126          0xE7FC4618,
    127          0x4602B530,
    128          0x2B00460B,
    129          0x2401D002,
    130          0xE0000264,
    131          0x25012400,
    132          0x43294621,
    133          0x4DB04CAF,
    134          0x462C612C,
    135          0x60626021,
    136          0x430C2440,
    137          0x358125FF,
    138          0x4DAB432C,
    139          0x462C602C,
    140          0x240068E0,
    141          0x612C602C,
    142          0x2200BD30,
    143          0x60826042,
    144          0x60C2880A,
    145          0x6102884A,
    146          0x61422200,
    147          0x6182684A,
    148          0xB0864770,
    149          0x499C48A1,
    150          0x48A161C8,
    151          0x90046B80,
    152          0x48A149A0,
    153          0xFFE9F7FF,
    154          0x48A149A0,
    155          0xFFE5F7FF,
    156          0xE0022700,
    157          0x68002000,
    158          0x2F641C7F,
    159          0x2000D3FA,
    160          0x489B9005,
    161          0x07C06800,
    162          0x90050F80,
    163          0x68004896,
    164          0x0FC007C0,
    165          0x43089905,
    166          0x20009005,
    167          0x61084992,
    168          0x618860C8,
    169          0x61084992,
    170          0x618860C8,
    171          0x28009805,
    172          0x2801D006,
    173          0x2802D00B,
    174          0x2803D00A,
    175          0xE008D106,
    176          0x02C92101,
    177          0x43089804,
    178          0x63884985,
    179          0xBF00E0F7,
    180          0x4983BF00,
    181          0x63889804,
    182          0x1E489905,
    183          0xFF18F7FF,
    184          0xBF009001,
    185          0x46044883,
    186          0xE00D9003,
    187          0x98014621,
    188          0xFF28F7FF,
    189          0xF7FF9801,
    190          0x3412FF41,
    191          0xF7FF9801,
    192          0x2800FF47,
    193          0x9403D000,
    194          0x4284487B,
    195          0x9803D203,
    196          0x285A1A20,
    197          0x9803D3EA,
    198          0x285A1A20,
    199          0xE00DD3E2,
    200          0x98014621,
    201          0xFF0EF7FF,
    202          0xF7FF9801,
    203          0x9801FF27,
    204          0xFF2EF7FF,
    205          0xD0002800,
    206          0x3412E003,
    207          0x4284486E,
    208          0xBF00D3EE,
    209          0x19009803,
    210          0x46210844,
    211          0xF7FF9801,
    212          0x2700FEF9,
    213          0x9801E003,
    214          0xFF10F7FF,
    215          0x2F101C7F,
    216          0x260DD3F9,
    217          0x2000BF00,
    218          0x0A309002,
    219          0x2069D001,
    220          0x98029002,
    221          0xD1782800,
    222          0xD0422E4C,
    223          0x2E00DC06,
    224          0x2E0DD009,
    225          0x2E42D008,
    226          0xE012D170,
    227          0xD0742E52,
    228          0xD1F92E59,
    229          0xE085E036,
    230          0x9801210D,
    231          0xFEE3F7FF,
    232          0x9801210A,
    233          0xFEDFF7FF,
    234          0x9801213E,
    235          0xFEDBF7FF,
    236          0x9801E078,
    237          0xFEFFF7FF,
    238          0x1C684605,
    239          0x2069D102,
    240          0xE06F9002,
    241          0xD1022D00,
    242          0x90022062,
    243          0x214BE06A,
    244          0x436101C9,
    245          0x46294608,
    246          0xF8ACF000,
    247          0x2D404605,
    248          0x2001D303,
    249          0x42850580,
    250          0x2062D302,
    251          0xE0599002,
    252          0x98012142,
    253          0xFEB7F7FF,
    254          0x98014629,
    255          0xFEA2F7FF,
    256          0xBF00E050,
    257          0xF7FF9801,
    258          0x4605FED6,
    259          0xF7FF9801,
    260          0x9000FED2,
    261          0xD0021C68,
    262          0x1C409800,
    263          0x2069D102,
    264          0xE03F9002,
    265          0x98014631,
    266          0xFE9DF7FF,
    267          0x19409800,
    268          0xE0129000,
    269          0xD1042E59,
    270          0x98017829,
    271          0xFE93F7FF,
    272          0x9801E00A,
    273          0xFE9AF7FF,
    274          0x0A184603,
    275          0x2069D002,
    276          0xE0059002,
    277          0xBF00702B,
    278          0x98001C6D,
    279          0xD3E94285,
    280          0x9802BF00,
    281          0xD0032800,
    282          0xE01CE01C,
    283          0xE004E017,
    284          0x9801214B,
    285          0xFE77F7FF,
    286          0x9801E014,
    287          0xFE9BF7FF,
    288          0x1C684605,
    289          0x2069D102,
    290          0xE00B9002,
    291          0x98012152,
    292          0xFE69F7FF,
    293          0x60054819,
    294          0xFE32F7FF,
    295          0x2063BF00,
    296          0xBF009002,
    297          0x9802BF00,
    298          0xD0032800,
    299          0x98012145,
    300          0xFE59F7FF,
    301          0xF7FF9801,
    302          0x4606FE61,
    303          0xBF00E753,
    304          0xE7FEBF00,
    305          0x0000051C,
    306          0x40020000,
    307          0x40008000,
    308          0x00000301,
    309          0x8AAA5551,
    310          0x40018000,
    311          0x00061010,
    312          0x40060000,
    313          0x0000053C,
    314          0x40088000,
    315          0x00000534,
    316          0x40090000,
    317          0x00000A04,
    318          0x0000129A,
    319          0x20000000,
    320          0x4700480B,
    321          0xE7FEE7FE,
    322          0xE7FEE7FE,
    323          0xE7FEE7FE,
    324          0xE7FEE7FE,
    325          0xE7FEE7FE,
    326          0xE7FEE7FE,
    327          0xE7FEE7FE,
    328          0xE7FEE7FE,
    329          0xE7FEE7FE,
    330          0xE7FEE7FE,
    331          0x0000E7FE,
    332          0x00000085,
    333          0x460BB530,
    334          0x20004601,
    335          0x24012220,
    336          0x460DE009,
    337          0x429D40D5,
    338          0x461DD305,
    339          0x1B494095,
    340          0x40954625,
    341          0x46151940,
    342          0x2D001E52,
    343          0xBD30DCF1,
    344          0x25014C06,
    345          0xE0054E06,
    346          0x68E34620,
    347          0x432BC807,
    348          0x34104798,
    349          0xD3F742B4,
    350          0xFDBCF7FF,
    351          0x00000544,
    352          0x00000544,
    353          0x0002001A,
    354          0x40088000,
    355          0x0002001A,
    356          0x40088000,
    357          0x0002001A,
    358          0x40088000,
    359          0x00010001,
    360          0x00000000,
    361          0x00010001,
    362          0x00000000,
    363          0x00000000
    364          };
    365          
    366          
    367          void earase_flash(uint32_t is_all_flash, uint32_t address);
    368          void write_boot ();

   \                                 In section .bss, align 4
    369          uint32_t Is_Flash_Earase = 0;
   \                     Is_Flash_Earase:
   \   00000000                      DS8 4
    370          
    371          
    372          /*************************************************************************
    373           * FMC module initialization
    374           *************************************************************************/
    375          

   \                                 In section .text, align 2, keep-with-next
    376          void ProgramDelay(uint32_t Loops)
    377          {
   \                     ProgramDelay:
   \   00000000   0xB580             PUSH     {R7,LR}
    378            volatile uint32_t i = Loops;
   \   00000002   0x9000             STR      R0,[SP, #+0]
    379            for (; i > 0; i--);
   \                     ??ProgramDelay_0:
   \   00000004   0x9900             LDR      R1,[SP, #+0]
   \   00000006   0x2900             CMP      R1,#+0
   \   00000008   0xD003             BEQ      ??ProgramDelay_1
   \   0000000A   0x9900             LDR      R1,[SP, #+0]
   \   0000000C   0x1E49             SUBS     R1,R1,#+1
   \   0000000E   0x9100             STR      R1,[SP, #+0]
   \   00000010   0xE7F8             B        ??ProgramDelay_0
    380          }
   \                     ??ProgramDelay_1:
   \   00000012   0xBD01             POP      {R0,PC}          ;; return
    381          //#define DEBUG 1
    382          #if DEBUG
    383          #define DEBUG_PRINTF(...) printf(__VA_ARGS__)
    384          #define PUTCHAR_PROTOTYPE int fputc(int ch, FILE *f)
    385          #else
    386          #define DEBUG_PRINTF(...)
    387          #endif
    388          
    389          #if DEBUG
    390          PUTCHAR_PROTOTYPE{
    391                  MDR_UART1->DR = ch;
    392                  // Loop until the end of transmission
    393          		while((MDR_UART1->FR & (1 << 5)) == (1 << 5));
    394            return (ch);
    395          }
    396          #endif
    397          #if USE_ARGC_ARGV
    398          uint32_t FlashInit(void *base_of_flash, uint32_t image_size,
    399                             uint32_t link_address, uint32_t flags,
    400                             int argc, char const *argv[])
    401          #else

   \                                 In section .text, align 2, keep-with-next
    402          uint32_t FlashInit(void *base_of_flash, uint32_t image_size,
    403                             uint32_t link_address, uint32_t flags)
    404          #endif
    405          {
   \                     FlashInit:
   \   00000000   0xB430             PUSH     {R4,R5}
   \   00000002   0x0004             MOVS     R4,R0
    406          	MDR_RST_CLK->PER2_CLOCK = 0xFFFFFFFF;
   \   00000004   0x....             LDR      R0,??DataTable3  ;; 0x4002001c
   \   00000006   0x2500             MOVS     R5,#+0
   \   00000008   0x43ED             MVNS     R5,R5            ;; #-1
   \   0000000A   0x6005             STR      R5,[R0, #+0]
    407            	MDR_RST_CLK->CPU_CLOCK&=~(3<<8);
   \   0000000C   0x....             LDR      R0,??DataTable4  ;; 0x4002000c
   \   0000000E   0x6800             LDR      R0,[R0, #+0]
   \   00000010   0x....             LDR      R5,??DataTable3_1  ;; 0xfffffcff
   \   00000012   0x4005             ANDS     R5,R5,R0
   \   00000014   0x....             LDR      R0,??DataTable4  ;; 0x4002000c
   \   00000016   0x6005             STR      R5,[R0, #+0]
    408          
    409          #if DEBUG	
    410          	// Отладка
    411          	MDR_RST_CLK->PER1_CLOCK = 0x30;
    412          
    413          	/* enable HSE */
    414          	MDR_RST_CLK->HS_CONTROL	= 1;
    415          	/* wait HSE */
    416          	while((MDR_RST_CLK->CLOCK_STATUS & (1 << 2)) != (1 << 2));
    417          
    418          	/* use pll frequency */
    419          	MDR_RST_CLK->CPU_CLOCK = (2 << 0) | (0 << 2) | (1 << 8);
    420          
    421          	/* set per 1 clock = HSE/2 = 4 MHz */
    422          	/* set per 2 clock = HSE*4 = 32 MHz */
    423          	MDR_RST_CLK->PER1_CLOCK =  (0 << 0) | (0 << 2)  | (1 << 4);
    424          
    425          	/* enable clock for uart, port and adciu */
    426          	MDR_RST_CLK->PER2_CLOCK |= (1 << 1 ) | (1 << 13) | (1 << 17);
    427          	MDR_RST_CLK->UART_CLOCK =  1 << 24  ;
    428          	
    429          	/*  set portb 0 and portb 1 for uart */
    430          	MDR_PORTB->ANALOG = (3 << 0);
    431          	MDR_PORTB->FUNC	= (1 << 0) | (1 << 2);
    432          	MDR_PORTB->OE = (0 << 0) | (1 << 0);
    433          	MDR_PORTB->PWR = (3 << 0) | (3 << 2);
    434          	MDR_PORTB->PULL = 0;
    435          	MDR_PORTB->GFEN = 0;
    436          	MDR_PORTB->PD = 0;
    437          
    438          	// Настройка UART
    439          	/* uart settings */
    440          	MDR_UART1->IBRD = 4;
    441          	MDR_UART1->FBRD = 29;
    442          	MDR_UART1->LCR_H = (1 << 4) | (3 << 5);
    443          	MDR_UART1->CR = (1<<8) | (1<<9) | (1<<0);
    444          
    445          	//DEBUG_PRINTF("test");
    446          #endif	
    447          	//FlashErase(0,0);
    448          	return RESULT_OK;
   \   00000018   0x2000             MOVS     R0,#+0
   \   0000001A   0xBC30             POP      {R4,R5}
   \   0000001C   0x4770             BX       LR               ;; return
    449          }
    450          
    451          

   \                                 In section .text, align 2, keep-with-next
    452          uint32_t FlashWrite(void *block_start,
    453                              uint32_t offset_into_block,
    454                              uint32_t count,
    455                              char const *buffer)
    456          {
   \                     FlashWrite:
   \   00000000   0xB5F8             PUSH     {R3-R7,LR}
   \   00000002   0x0004             MOVS     R4,R0
    457              DEBUG_PRINTF("\t\tFlashWrite block_start 0x%x, offset_into_block 0x%x, count 0x%X, buffer 0x%x\n\r",(uint32_t)block_start,offset_into_block,count,(uint32_t)buffer);	
    458          	
    459          	uint32_t * ptr_buffer = (uint32_t *)buffer;  
   \   00000004   0x001D             MOVS     R5,R3
    460          	uint32_t size = 0;
   \   00000006   0x2600             MOVS     R6,#+0
    461          	volatile uint32_t y = 0;
   \   00000008   0x2000             MOVS     R0,#+0
   \   0000000A   0x9000             STR      R0,[SP, #+0]
    462          	
    463          	if((MDR_BKP->REG_0E&0x00000800) == 0x00000000) return(0);
   \   0000000C   0x....             LDR      R0,??DataTable3_2  ;; 0x40060038
   \   0000000E   0x6800             LDR      R0,[R0, #+0]
   \   00000010   0x0500             LSLS     R0,R0,#+20
   \   00000012   0xD401             BMI      ??FlashWrite_0
   \   00000014   0x2000             MOVS     R0,#+0
   \   00000016   0xE062             B        ??FlashWrite_1
    464              MDR_RST_CLK->PER2_CLOCK = 0xFFFFFFFF;
   \                     ??FlashWrite_0:
   \   00000018   0x....             LDR      R0,??DataTable3  ;; 0x4002001c
   \   0000001A   0x2700             MOVS     R7,#+0
   \   0000001C   0x43FF             MVNS     R7,R7            ;; #-1
   \   0000001E   0x6007             STR      R7,[R0, #+0]
    465          	
    466          	while( size < count/4 ){
   \                     ??FlashWrite_2:
   \   00000020   0x0010             MOVS     R0,R2
   \   00000022   0x0880             LSRS     R0,R0,#+2
   \   00000024   0x4286             CMP      R6,R0
   \   00000026   0xD259             BCS      ??FlashWrite_3
    467          	  
    468          		MDR_EEPROM->KEY = 0x8AAA5551;
   \   00000028   0x....             LDR      R0,??DataTable4_1  ;; 0x40018010
   \   0000002A   0x....             LDR      R7,??DataTable3_3  ;; 0x8aaa5551
   \   0000002C   0x6007             STR      R7,[R0, #+0]
    469          		
    470          		MDR_EEPROM->CMD = 0x0001 ;
   \   0000002E   0x....             LDR      R0,??DataTable4_2  ;; 0x40018000
   \   00000030   0x2701             MOVS     R7,#+1
   \   00000032   0x6007             STR      R7,[R0, #+0]
    471          		MDR_EEPROM->ADR = (uint32_t) ((uint32_t)block_start + offset_into_block + size*4);
   \   00000034   0x1860             ADDS     R0,R4,R1
   \   00000036   0x2704             MOVS     R7,#+4
   \   00000038   0x4377             MULS     R7,R6,R7
   \   0000003A   0x19C0             ADDS     R0,R0,R7
   \   0000003C   0x....             LDR      R7,??DataTable4_3  ;; 0x40018004
   \   0000003E   0x6038             STR      R0,[R7, #+0]
    472          		MDR_EEPROM->DI  = ptr_buffer[size];
   \   00000040   0x2004             MOVS     R0,#+4
   \   00000042   0x4370             MULS     R0,R6,R0
   \   00000044   0x5828             LDR      R0,[R5, R0]
   \   00000046   0x....             LDR      R7,??DataTable4_4  ;; 0x40018008
   \   00000048   0x6038             STR      R0,[R7, #+0]
    473          		
    474          		MDR_EEPROM->CMD = 0x1041;	// Set PROG XE EN
   \   0000004A   0x....             LDR      R0,??DataTable4_2  ;; 0x40018000
   \   0000004C   0x....             LDR      R7,??DataTable4_5  ;; 0x1041
   \   0000004E   0x6007             STR      R7,[R0, #+0]
    475          		for (y=0;y<40;y++); // 5 мкс
   \   00000050   0x2000             MOVS     R0,#+0
   \   00000052   0x9000             STR      R0,[SP, #+0]
   \                     ??FlashWrite_4:
   \   00000054   0x9800             LDR      R0,[SP, #+0]
   \   00000056   0x2828             CMP      R0,#+40
   \   00000058   0xD203             BCS      ??FlashWrite_5
   \   0000005A   0x9800             LDR      R0,[SP, #+0]
   \   0000005C   0x1C40             ADDS     R0,R0,#+1
   \   0000005E   0x9000             STR      R0,[SP, #+0]
   \   00000060   0xE7F8             B        ??FlashWrite_4
    476          		
    477          		MDR_EEPROM->CMD = 0x3041; // SET NVSTR
   \                     ??FlashWrite_5:
   \   00000062   0x....             LDR      R0,??DataTable4_2  ;; 0x40018000
   \   00000064   0x....             LDR      R7,??DataTable4_6  ;; 0x3041
   \   00000066   0x6007             STR      R7,[R0, #+0]
    478          		for (y=0;y<80;y++);	//10 мкс
   \   00000068   0x2000             MOVS     R0,#+0
   \   0000006A   0x9000             STR      R0,[SP, #+0]
   \                     ??FlashWrite_6:
   \   0000006C   0x9800             LDR      R0,[SP, #+0]
   \   0000006E   0x2850             CMP      R0,#+80
   \   00000070   0xD203             BCS      ??FlashWrite_7
   \   00000072   0x9800             LDR      R0,[SP, #+0]
   \   00000074   0x1C40             ADDS     R0,R0,#+1
   \   00000076   0x9000             STR      R0,[SP, #+0]
   \   00000078   0xE7F8             B        ??FlashWrite_6
    479          		
    480          		MDR_EEPROM->CMD = 0x30C1; // SET YE
   \                     ??FlashWrite_7:
   \   0000007A   0x....             LDR      R0,??DataTable4_2  ;; 0x40018000
   \   0000007C   0x....             LDR      R7,??DataTable4_7  ;; 0x30c1
   \   0000007E   0x6007             STR      R7,[R0, #+0]
    481          		for (y=0;y<400;y++); 	//40 мкс
   \   00000080   0x2000             MOVS     R0,#+0
   \   00000082   0x9000             STR      R0,[SP, #+0]
   \                     ??FlashWrite_8:
   \   00000084   0x9800             LDR      R0,[SP, #+0]
   \   00000086   0x27C8             MOVS     R7,#+200
   \   00000088   0x007F             LSLS     R7,R7,#+1        ;; #+400
   \   0000008A   0x42B8             CMP      R0,R7
   \   0000008C   0xD203             BCS      ??FlashWrite_9
   \   0000008E   0x9800             LDR      R0,[SP, #+0]
   \   00000090   0x1C40             ADDS     R0,R0,#+1
   \   00000092   0x9000             STR      R0,[SP, #+0]
   \   00000094   0xE7F6             B        ??FlashWrite_8
    482          		
    483          		MDR_EEPROM->CMD = 0x3041; // CLEAR YE
   \                     ??FlashWrite_9:
   \   00000096   0x....             LDR      R0,??DataTable4_2  ;; 0x40018000
   \   00000098   0x....             LDR      R7,??DataTable4_6  ;; 0x3041
   \   0000009A   0x6007             STR      R7,[R0, #+0]
    484          		MDR_EEPROM->CMD = 0x2041;	// CLER PROG 
   \   0000009C   0x....             LDR      R0,??DataTable4_2  ;; 0x40018000
   \   0000009E   0x....             LDR      R7,??DataTable4_8  ;; 0x2041
   \   000000A0   0x6007             STR      R7,[R0, #+0]
    485          		for (y=0;y<40;y++);		// 5 мкс
   \   000000A2   0x2000             MOVS     R0,#+0
   \   000000A4   0x9000             STR      R0,[SP, #+0]
   \                     ??FlashWrite_10:
   \   000000A6   0x9800             LDR      R0,[SP, #+0]
   \   000000A8   0x2828             CMP      R0,#+40
   \   000000AA   0xD203             BCS      ??FlashWrite_11
   \   000000AC   0x9800             LDR      R0,[SP, #+0]
   \   000000AE   0x1C40             ADDS     R0,R0,#+1
   \   000000B0   0x9000             STR      R0,[SP, #+0]
   \   000000B2   0xE7F8             B        ??FlashWrite_10
    486          		
    487          		MDR_EEPROM->CMD = 0x0001; // CLEAR NVSTR XE
   \                     ??FlashWrite_11:
   \   000000B4   0x....             LDR      R0,??DataTable4_2  ;; 0x40018000
   \   000000B6   0x2701             MOVS     R7,#+1
   \   000000B8   0x6007             STR      R7,[R0, #+0]
    488          		for (y=0;y<10;y++);
   \   000000BA   0x2000             MOVS     R0,#+0
   \   000000BC   0x9000             STR      R0,[SP, #+0]
   \                     ??FlashWrite_12:
   \   000000BE   0x9800             LDR      R0,[SP, #+0]
   \   000000C0   0x280A             CMP      R0,#+10
   \   000000C2   0xD203             BCS      ??FlashWrite_13
   \   000000C4   0x9800             LDR      R0,[SP, #+0]
   \   000000C6   0x1C40             ADDS     R0,R0,#+1
   \   000000C8   0x9000             STR      R0,[SP, #+0]
   \   000000CA   0xE7F8             B        ??FlashWrite_12
    489          		
    490          		MDR_EEPROM->CMD = 0x0000; // CLEAR NVSTR XE
   \                     ??FlashWrite_13:
   \   000000CC   0x....             LDR      R0,??DataTable4_2  ;; 0x40018000
   \   000000CE   0x2700             MOVS     R7,#+0
   \   000000D0   0x6007             STR      R7,[R0, #+0]
    491          		MDR_EEPROM->KEY = 0;
   \   000000D2   0x....             LDR      R0,??DataTable4_1  ;; 0x40018010
   \   000000D4   0x2700             MOVS     R7,#+0
   \   000000D6   0x6007             STR      R7,[R0, #+0]
    492          		    
    493          		size++;
   \   000000D8   0x1C76             ADDS     R6,R6,#+1
   \   000000DA   0xE7A1             B        ??FlashWrite_2
    494          	}                
    495          
    496          	//for(int i = 0; i < 16; i++)
    497          	//  printf("\tflash_data = 0x%x\r\n", ptr[i]);
    498          
    499              return(RESULT_OK);
   \                     ??FlashWrite_3:
   \   000000DC   0x2000             MOVS     R0,#+0
   \                     ??FlashWrite_1:
   \   000000DE   0xBDF2             POP      {R1,R4-R7,PC}    ;; return
    500          }
    501          
    502          /*************************************************************************
    503           * FMC Block erase
    504           *************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    505          uint32_t FlashErase(void *block_start,
    506                              uint32_t block_size)
    507          {
   \                     FlashErase:
   \   00000000   0xB570             PUSH     {R4-R6,LR}
   \   00000002   0x0004             MOVS     R4,R0
   \   00000004   0x000D             MOVS     R5,R1
    508          	DEBUG_PRINTF("FlasErase block_start 0x%x, block_size 0x%x\n\r",(uint32_t)block_start,block_size);
    509          	
    510          	//if(MDR_BKP->REG_0E & BKP_REG_0E_FPOR)
    511          	//	DEBUG_PRINTF("earse all\r\n");
    512          	
    513          	for (uint32_t y = 0; y<=0x18000; y=y+0x8000){
   \   00000006   0x2600             MOVS     R6,#+0
   \                     ??FlashErase_0:
   \   00000008   0x....             LDR      R0,??DataTable4_9  ;; 0x18001
   \   0000000A   0x4286             CMP      R6,R0
   \   0000000C   0xD20B             BCS      ??FlashErase_1
    514          		DEBUG_PRINTF("Erasing...\r\n");
    515          		DEBUG_PRINTF("%d\r\n",((MDR_BKP->REG_0E & BKP_REG_0E_FPOR) >> BKP_REG_0E_FPOR_Pos));
    516          		earase_flash(((MDR_BKP->REG_0E & BKP_REG_0E_FPOR) >> BKP_REG_0E_FPOR_Pos), (uint32_t)y);	
   \   0000000E   0x0031             MOVS     R1,R6
   \   00000010   0x....             LDR      R0,??DataTable3_2  ;; 0x40060038
   \   00000012   0x6802             LDR      R2,[R0, #+0]
   \   00000014   0x0010             MOVS     R0,R2
   \   00000016   0x0500             LSLS     R0,R0,#+20       ;; ZeroExtS R0,R0,#+20,#+31
   \   00000018   0x0FC0             LSRS     R0,R0,#+31
   \   0000001A   0x.... 0x....      BL       earase_flash
    517          	}
   \   0000001E   0x2080             MOVS     R0,#+128
   \   00000020   0x0200             LSLS     R0,R0,#+8        ;; #+32768
   \   00000022   0x1836             ADDS     R6,R6,R0
   \   00000024   0xE7F0             B        ??FlashErase_0
    518          	MDR_EEPROM->CMD = 0;
   \                     ??FlashErase_1:
   \   00000026   0x....             LDR      R0,??DataTable4_2  ;; 0x40018000
   \   00000028   0x2100             MOVS     R1,#+0
   \   0000002A   0x6001             STR      R1,[R0, #+0]
    519          	// востанавливаем 
    520          	if((MDR_BKP->REG_0E & BKP_REG_0E_FPOR) == 0){
   \   0000002C   0x....             LDR      R0,??DataTable3_2  ;; 0x40060038
   \   0000002E   0x6800             LDR      R0,[R0, #+0]
   \   00000030   0x0500             LSLS     R0,R0,#+20
   \   00000032   0xD401             BMI      ??FlashErase_2
    521          		DEBUG_PRINTF("write boot\r\n");
    522          		write_boot ();
   \   00000034   0x.... 0x....      BL       write_boot
    523          	}
    524          	return(RESULT_OK);
   \                     ??FlashErase_2:
   \   00000038   0x2000             MOVS     R0,#+0
   \   0000003A   0xBD70             POP      {R4-R6,PC}       ;; return
    525          }
    526          
    527          
    528          
    529          /*************************************************************************
    530           * FMC deinit
    531           *************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    532          uint32_t FlashSignoff()
    533          {
    534            /*Enable ISP function*/
    535            /*Enable ISP function*/
    536           
    537            return RESULT_OK;
   \                     FlashSignoff:
   \   00000000   0x2000             MOVS     R0,#+0
   \   00000002   0x4770             BX       LR               ;; return
    538          }
    539          

   \                                 In section .text, align 2, keep-with-next
    540          void earase_flash(uint32_t is_all_flash, uint32_t address)
    541          {
   \                     earase_flash:
   \   00000000   0xB530             PUSH     {R4,R5,LR}
    542          	uint32_t i;
    543          	uint32_t j = 1;;
   \   00000002   0x2301             MOVS     R3,#+1
    544          	if(is_all_flash)
   \   00000004   0x2800             CMP      R0,#+0
   \   00000006   0xD001             BEQ      ??earase_flash_0
    545          		j = 0;
   \   00000008   0x2400             MOVS     R4,#+0
   \   0000000A   0x0023             MOVS     R3,R4
    546          	MDR_EEPROM->CMD = 0x1 | (j << EEPROM_CMD_IFREN_Pos);
   \                     ??earase_flash_0:
   \   0000000C   0x025C             LSLS     R4,R3,#+9
   \   0000000E   0x2501             MOVS     R5,#+1
   \   00000010   0x4325             ORRS     R5,R5,R4
   \   00000012   0x....             LDR      R4,??DataTable4_2  ;; 0x40018000
   \   00000014   0x6025             STR      R5,[R4, #+0]
    547          	MDR_EEPROM->KEY = 0x8AAA5551;
   \   00000016   0x....             LDR      R4,??DataTable4_1  ;; 0x40018010
   \   00000018   0x....             LDR      R5,??DataTable3_3  ;; 0x8aaa5551
   \   0000001A   0x6025             STR      R5,[R4, #+0]
    548          	 
    549          	MDR_EEPROM->ADR = address;
   \   0000001C   0x....             LDR      R4,??DataTable4_3  ;; 0x40018004
   \   0000001E   0x6021             STR      R1,[R4, #+0]
    550            	MDR_EEPROM->DI  = 0;
   \   00000020   0x....             LDR      R4,??DataTable4_4  ;; 0x40018008
   \   00000022   0x2500             MOVS     R5,#+0
   \   00000024   0x6025             STR      R5,[R4, #+0]
    551          	MDR_EEPROM->CMD = 0x0001 | (j << EEPROM_CMD_IFREN_Pos);
   \   00000026   0x025C             LSLS     R4,R3,#+9
   \   00000028   0x2501             MOVS     R5,#+1
   \   0000002A   0x4325             ORRS     R5,R5,R4
   \   0000002C   0x....             LDR      R4,??DataTable4_2  ;; 0x40018000
   \   0000002E   0x6025             STR      R5,[R4, #+0]
    552          	MDR_EEPROM->CMD = 0x0003 | (j << EEPROM_CMD_IFREN_Pos);
   \   00000030   0x025C             LSLS     R4,R3,#+9
   \   00000032   0x2503             MOVS     R5,#+3
   \   00000034   0x4325             ORRS     R5,R5,R4
   \   00000036   0x....             LDR      R4,??DataTable4_2  ;; 0x40018000
   \   00000038   0x6025             STR      R5,[R4, #+0]
    553          	MDR_EEPROM->CMD = 0x0001 | (j << EEPROM_CMD_IFREN_Pos);
   \   0000003A   0x025C             LSLS     R4,R3,#+9
   \   0000003C   0x2501             MOVS     R5,#+1
   \   0000003E   0x4325             ORRS     R5,R5,R4
   \   00000040   0x....             LDR      R4,??DataTable4_2  ;; 0x40018000
   \   00000042   0x6025             STR      R5,[R4, #+0]
    554          	MDR_EEPROM->CMD = 0x0c41 | (j << EEPROM_CMD_IFREN_Pos);
   \   00000044   0x025C             LSLS     R4,R3,#+9
   \   00000046   0x....             LDR      R5,??DataTable4_10  ;; 0xc41
   \   00000048   0x4325             ORRS     R5,R5,R4
   \   0000004A   0x....             LDR      R4,??DataTable4_2  ;; 0x40018000
   \   0000004C   0x6025             STR      R5,[R4, #+0]
    555          	
    556            	for (i=0;i<40;i++);
   \   0000004E   0x2400             MOVS     R4,#+0
   \   00000050   0x0022             MOVS     R2,R4
   \                     ??earase_flash_1:
   \   00000052   0x2A28             CMP      R2,#+40
   \   00000054   0xD201             BCS      ??earase_flash_2
   \   00000056   0x1C52             ADDS     R2,R2,#+1
   \   00000058   0xE7FB             B        ??earase_flash_1
    557          	
    558          	MDR_EEPROM->CMD = 0x2c41 | (j << EEPROM_CMD_IFREN_Pos);
   \                     ??earase_flash_2:
   \   0000005A   0x025C             LSLS     R4,R3,#+9
   \   0000005C   0x....             LDR      R5,??DataTable4_11  ;; 0x2c41
   \   0000005E   0x4325             ORRS     R5,R5,R4
   \   00000060   0x....             LDR      R4,??DataTable4_2  ;; 0x40018000
   \   00000062   0x6025             STR      R5,[R4, #+0]
    559            	for (i=0;i<320000;i++);
   \   00000064   0x2400             MOVS     R4,#+0
   \   00000066   0x0022             MOVS     R2,R4
   \                     ??earase_flash_3:
   \   00000068   0x....             LDR      R4,??DataTable4_12  ;; 0x4e200
   \   0000006A   0x42A2             CMP      R2,R4
   \   0000006C   0xD201             BCS      ??earase_flash_4
   \   0000006E   0x1C52             ADDS     R2,R2,#+1
   \   00000070   0xE7FA             B        ??earase_flash_3
    560          	MDR_EEPROM->CMD = 0x2841 | (j << EEPROM_CMD_IFREN_Pos);
   \                     ??earase_flash_4:
   \   00000072   0x025C             LSLS     R4,R3,#+9
   \   00000074   0x....             LDR      R5,??DataTable4_13  ;; 0x2841
   \   00000076   0x4325             ORRS     R5,R5,R4
   \   00000078   0x....             LDR      R4,??DataTable4_2  ;; 0x40018000
   \   0000007A   0x6025             STR      R5,[R4, #+0]
    561            	for (i=0;i<800;i++)
   \   0000007C   0x2400             MOVS     R4,#+0
   \   0000007E   0x0022             MOVS     R2,R4
   \                     ??earase_flash_5:
   \   00000080   0x24C8             MOVS     R4,#+200
   \   00000082   0x00A4             LSLS     R4,R4,#+2        ;; #+800
   \   00000084   0x42A2             CMP      R2,R4
   \   00000086   0xD204             BCS      ??earase_flash_6
    562          	MDR_EEPROM->CMD = 0x0001;
   \   00000088   0x....             LDR      R4,??DataTable4_2  ;; 0x40018000
   \   0000008A   0x2501             MOVS     R5,#+1
   \   0000008C   0x6025             STR      R5,[R4, #+0]
   \   0000008E   0x1C52             ADDS     R2,R2,#+1
   \   00000090   0xE7F6             B        ??earase_flash_5
    563          	
    564          	MDR_EEPROM->CMD = 0x00;
   \                     ??earase_flash_6:
   \   00000092   0x....             LDR      R4,??DataTable4_2  ;; 0x40018000
   \   00000094   0x2500             MOVS     R5,#+0
   \   00000096   0x6025             STR      R5,[R4, #+0]
    565          }
   \   00000098   0xBD30             POP      {R4,R5,PC}       ;; return
    566          
    567          

   \                                 In section .text, align 4, keep-with-next
    568          void write_boot ()
    569          {
   \                     write_boot:
   \   00000000   0xB500             PUSH     {LR}
    570          	int i,y;
    571          	MDR_EEPROM->KEY = 0x8AAA5551;
   \   00000002   0x....             LDR      R2,??DataTable4_1  ;; 0x40018010
   \   00000004   0x....             LDR      R3,??DataTable4_14  ;; 0x8aaa5551
   \   00000006   0x6013             STR      R3,[R2, #+0]
    572          	MDR_EEPROM->CMD = 0x0201;
   \   00000008   0x....             LDR      R2,??DataTable4_2  ;; 0x40018000
   \   0000000A   0x....             LDR      R3,??DataTable4_15  ;; 0x201
   \   0000000C   0x6013             STR      R3,[R2, #+0]
    573          	
    574          	for(i=0;i<BOOT_SIZE;i++){	
   \   0000000E   0x2200             MOVS     R2,#+0
   \   00000010   0x0010             MOVS     R0,R2
   \                     ??write_boot_0:
   \   00000012   0x22FF             MOVS     R2,#+255
   \   00000014   0x3256             ADDS     R2,R2,#+86       ;; #+341
   \   00000016   0x4290             CMP      R0,R2
   \   00000018   0xDA4B             BGE      ??write_boot_1
    575          	  	MDR_EEPROM->ADR = i*4;
   \   0000001A   0x2204             MOVS     R2,#+4
   \   0000001C   0x4342             MULS     R2,R0,R2
   \   0000001E   0x....             LDR      R3,??DataTable4_3  ;; 0x40018004
   \   00000020   0x601A             STR      R2,[R3, #+0]
    576          	  	for (y=0;y<80;y++);
   \   00000022   0x2200             MOVS     R2,#+0
   \   00000024   0x0011             MOVS     R1,R2
   \                     ??write_boot_2:
   \   00000026   0x2950             CMP      R1,#+80
   \   00000028   0xDA01             BGE      ??write_boot_3
   \   0000002A   0x1C49             ADDS     R1,R1,#+1
   \   0000002C   0xE7FB             B        ??write_boot_2
    577          		MDR_EEPROM->CMD = 0x1241;	// Set PROG XE EN
   \                     ??write_boot_3:
   \   0000002E   0x....             LDR      R2,??DataTable4_2  ;; 0x40018000
   \   00000030   0x....             LDR      R3,??DataTable4_16  ;; 0x1241
   \   00000032   0x6013             STR      R3,[R2, #+0]
    578          	  	for (y=0;y<40;y++);
   \   00000034   0x2200             MOVS     R2,#+0
   \   00000036   0x0011             MOVS     R1,R2
   \                     ??write_boot_4:
   \   00000038   0x2928             CMP      R1,#+40
   \   0000003A   0xDA01             BGE      ??write_boot_5
   \   0000003C   0x1C49             ADDS     R1,R1,#+1
   \   0000003E   0xE7FB             B        ??write_boot_4
    579          		MDR_EEPROM->CMD = 0x3241; // SET NVSTR
   \                     ??write_boot_5:
   \   00000040   0x....             LDR      R2,??DataTable4_2  ;; 0x40018000
   \   00000042   0x....             LDR      R3,??DataTable4_17  ;; 0x3241
   \   00000044   0x6013             STR      R3,[R2, #+0]
    580          	  	MDR_EEPROM->DI  = BOOT_LOADER[i];
   \   00000046   0x2204             MOVS     R2,#+4
   \   00000048   0x4342             MULS     R2,R0,R2
   \   0000004A   0x4B1C             LDR      R3,??write_boot_6
   \   0000004C   0x447B             ADD      R3,R3,PC
   \   0000004E   0x336C             ADDS     R3,R3,#+108
   \   00000050   0x589A             LDR      R2,[R3, R2]
   \   00000052   0x....             LDR      R3,??DataTable4_4  ;; 0x40018008
   \   00000054   0x601A             STR      R2,[R3, #+0]
    581          		MDR_EEPROM->CMD = 0x3243; // SET NVSTR
   \   00000056   0x....             LDR      R2,??DataTable4_2  ;; 0x40018000
   \   00000058   0x....             LDR      R3,??DataTable4_18  ;; 0x3243
   \   0000005A   0x6013             STR      R3,[R2, #+0]
    582          		MDR_EEPROM->CMD = 0x3241; // SET NVSTR
   \   0000005C   0x....             LDR      R2,??DataTable4_2  ;; 0x40018000
   \   0000005E   0x....             LDR      R3,??DataTable4_17  ;; 0x3241
   \   00000060   0x6013             STR      R3,[R2, #+0]
    583          	  	for (y=0;y<100;y++);
   \   00000062   0x2200             MOVS     R2,#+0
   \   00000064   0x0011             MOVS     R1,R2
   \                     ??write_boot_7:
   \   00000066   0x2964             CMP      R1,#+100
   \   00000068   0xDA01             BGE      ??write_boot_8
   \   0000006A   0x1C49             ADDS     R1,R1,#+1
   \   0000006C   0xE7FB             B        ??write_boot_7
    584          		MDR_EEPROM->CMD = 0x32C1; // SET YE
   \                     ??write_boot_8:
   \   0000006E   0x....             LDR      R2,??DataTable4_2  ;; 0x40018000
   \   00000070   0x....             LDR      R3,??DataTable4_19  ;; 0x32c1
   \   00000072   0x6013             STR      R3,[R2, #+0]
    585          
    586          	  	for (y=0;y<400;y++);
   \   00000074   0x2200             MOVS     R2,#+0
   \   00000076   0x0011             MOVS     R1,R2
   \                     ??write_boot_9:
   \   00000078   0x22C8             MOVS     R2,#+200
   \   0000007A   0x0052             LSLS     R2,R2,#+1        ;; #+400
   \   0000007C   0x4291             CMP      R1,R2
   \   0000007E   0xDA01             BGE      ??write_boot_10
   \   00000080   0x1C49             ADDS     R1,R1,#+1
   \   00000082   0xE7F9             B        ??write_boot_9
    587          		MDR_EEPROM->CMD = 0x3241; // CLEAR YE
   \                     ??write_boot_10:
   \   00000084   0x....             LDR      R2,??DataTable4_2  ;; 0x40018000
   \   00000086   0x....             LDR      R3,??DataTable4_17  ;; 0x3241
   \   00000088   0x6013             STR      R3,[R2, #+0]
    588          		MDR_EEPROM->CMD = 0x2241;	// CLER PROG 
   \   0000008A   0x....             LDR      R2,??DataTable4_2  ;; 0x40018000
   \   0000008C   0x....             LDR      R3,??DataTable4_20  ;; 0x2241
   \   0000008E   0x6013             STR      R3,[R2, #+0]
    589            		for (y=0;y<40;y++);
   \   00000090   0x2200             MOVS     R2,#+0
   \   00000092   0x0011             MOVS     R1,R2
   \                     ??write_boot_11:
   \   00000094   0x2928             CMP      R1,#+40
   \   00000096   0xDA01             BGE      ??write_boot_12
   \   00000098   0x1C49             ADDS     R1,R1,#+1
   \   0000009A   0xE7FB             B        ??write_boot_11
    590          		MDR_EEPROM->CMD = 0x0201; // CLEAR NVSTR XE
   \                     ??write_boot_12:
   \   0000009C   0x....             LDR      R2,??DataTable4_2  ;; 0x40018000
   \   0000009E   0x....             LDR      R3,??DataTable4_15  ;; 0x201
   \   000000A0   0x6013             STR      R3,[R2, #+0]
    591            		for (y=0;y<40;y++);
   \   000000A2   0x2200             MOVS     R2,#+0
   \   000000A4   0x0011             MOVS     R1,R2
   \                     ??write_boot_13:
   \   000000A6   0x2928             CMP      R1,#+40
   \   000000A8   0xDA01             BGE      ??write_boot_14
   \   000000AA   0x1C49             ADDS     R1,R1,#+1
   \   000000AC   0xE7FB             B        ??write_boot_13
    592            	}
   \                     ??write_boot_14:
   \   000000AE   0x1C40             ADDS     R0,R0,#+1
   \   000000B0   0xE7AF             B        ??write_boot_0
    593          	
    594          	MDR_EEPROM->CMD = 0x0000;
   \                     ??write_boot_1:
   \   000000B2   0x....             LDR      R2,??DataTable4_2  ;; 0x40018000
   \   000000B4   0x2300             MOVS     R3,#+0
   \   000000B6   0x6013             STR      R3,[R2, #+0]
    595          }
   \   000000B8   0xBD00             POP      {PC}             ;; return
   \   000000BA   0xBF00             Nop      
   \                     ??write_boot_6:
   \   000000BC   0x........         DC32     BOOT_LOADER-.

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable3:
   \   00000000   0x4002001C         DC32     0x4002001c

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable3_1:
   \   00000000   0xFFFFFCFF         DC32     0xfffffcff

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable3_2:
   \   00000000   0x40060038         DC32     0x40060038

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable3_3:
   \   00000000   0x8AAA5551         DC32     0x8aaa5551

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4:
   \   00000000   0x4002000C         DC32     0x4002000c

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_1:
   \   00000000   0x40018010         DC32     0x40018010

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_2:
   \   00000000   0x40018000         DC32     0x40018000

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_3:
   \   00000000   0x40018004         DC32     0x40018004

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_4:
   \   00000000   0x40018008         DC32     0x40018008

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_5:
   \   00000000   0x00001041         DC32     0x1041

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_6:
   \   00000000   0x00003041         DC32     0x3041

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_7:
   \   00000000   0x000030C1         DC32     0x30c1

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_8:
   \   00000000   0x00002041         DC32     0x2041

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_9:
   \   00000000   0x00018001         DC32     0x18001

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_10:
   \   00000000   0x00000C41         DC32     0xc41

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_11:
   \   00000000   0x00002C41         DC32     0x2c41

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_12:
   \   00000000   0x0004E200         DC32     0x4e200

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_13:
   \   00000000   0x00002841         DC32     0x2841

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_14:
   \   00000000   0x8AAA5551         DC32     0x8aaa5551

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_15:
   \   00000000   0x00000201         DC32     0x201

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_16:
   \   00000000   0x00001241         DC32     0x1241

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_17:
   \   00000000   0x00003241         DC32     0x3241

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_18:
   \   00000000   0x00003243         DC32     0x3243

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_19:
   \   00000000   0x000032C1         DC32     0x32c1

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_20:
   \   00000000   0x00002241         DC32     0x2241

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
       16  FlashErase
             16 -> earase_flash
             16 -> write_boot
        8  FlashInit
        0  FlashSignoff
       24  FlashWrite
        8  ProgramDelay
       12  earase_flash
        4  write_boot


   Section sizes:

   Bytes  Function/Label
   -----  --------------
       4  ??DataTable3
       4  ??DataTable3_1
       4  ??DataTable3_2
       4  ??DataTable3_3
       4  ??DataTable4
       4  ??DataTable4_1
       4  ??DataTable4_10
       4  ??DataTable4_11
       4  ??DataTable4_12
       4  ??DataTable4_13
       4  ??DataTable4_14
       4  ??DataTable4_15
       4  ??DataTable4_16
       4  ??DataTable4_17
       4  ??DataTable4_18
       4  ??DataTable4_19
       4  ??DataTable4_2
       4  ??DataTable4_20
       4  ??DataTable4_3
       4  ??DataTable4_4
       4  ??DataTable4_5
       4  ??DataTable4_6
       4  ??DataTable4_7
       4  ??DataTable4_8
       4  ??DataTable4_9
    1364  BOOT_LOADER
      60  FlashErase
      30  FlashInit
       4  FlashSignoff
     224  FlashWrite
       4  Is_Flash_Earase
      20  ProgramDelay
     154  earase_flash
     192  write_boot

 
     4 bytes in section .bss
 1 364 bytes in section .rodata
   784 bytes in section .text
 
   784 bytes of CODE  memory
 1 364 bytes of CONST memory
     4 bytes of DATA  memory

Errors: none
Warnings: none
